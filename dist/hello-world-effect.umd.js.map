{"version":3,"file":"hello-world-effect.umd.js","sources":["../hello-world-effect.js"],"sourcesContent":["\nimport { Effect, BlendFunction } from \"postprocessing\";\nimport { Uniform, Vector3 } from \"three\";\n\nclass HelloWorldEffect extends Effect {\n  constructor({\n    blendFunction = BlendFunction.NORMAL,\n    weights = new Vector3(1.0, 1.0, 1.0),\n} = {}) {\n\n    const fragmentShader = `\n      uniform vec3 weights;\n        \n      void mainImage(const in vec4 inputColor, const in vec2 uv, out vec4 outputColor){\n        outputColor = vec4(inputColor.rgb * weights, inputColor.a);      \n      }\n`;\n\n    super(\"HelloWorldEffect\", fragmentShader, {\n      blendFunction,\n      uniforms: new Map([\n        [\"weights\", new Uniform(weights)],\n      ]),\n    });\n  }\n\n  updateWeights(r, g, b) {\n    // Set the weights uniform to the three components passed in\n    this.uniforms.get(\"weights\").value.set(r, g, b);\n  }\n\n}\n\nclass HelloWorldEffectElement extends HTMLElement {\n  static get observedAttributes() {\n    return ['red', 'green', 'blue'];\n  }\n\n  constructor() {\n    super();\n    // model-viewer-effects looks at the effects property of any child elements\n    // and expects a list of postprocressing Effects\n    this.effects = [ new HelloWorldEffect() ] ;\n  }\n\n  connectedCallback() {\n    super.connectedCallback && super.connectedCallback();\n\n    if (this.parentNode?.nodeName.toLowerCase() === \"effect-composer\") {\n      this.effectComposer = this.parentNode;\n    }\n\n    if (!this.effectComposer) {\n      throw new Error(\n        \"<hello-world-effect> must be a child of an <effect-composer>.\",\n      );\n    }\n\n    this.updateWeights();\n    // We poke the EffectComposer that there have been changes, and it needs to\n    // rebuild its EffectPasses\n    this.effectComposer.updateEffects();\n  }\n\n  disconnectedCallback() {\n    // When we are removed from the DOM, we need to clean up.\n    super.disconnectedCallback && super.disconnectedCallback();\n    for (const effect of this.effects) {\n      effect.dispose();\n    }\n    this.effectComposer?.updateEffects();\n  }\n\n  attributeChangedCallback(name, oldValue, newValue) {\n    this.updateWeights();\n    // After updating the weights, we need to tell the EffectComposer that it needs a new frame\n    this.effectComposer?.queueRender();\n  }\n\n  updateWeights() {\n    // We interact with the shader in our Effect through a three-component vector uniform called \"weights\"\n    // This element maps a red, green, and blue html attribute to the components of this vector.\n\n    let weights = [];\n    const attrs = ['red', 'green', 'blue'];\n\n    for (const attr of attrs) {\n      if (!this.hasAttribute(attr)) {\n        weights.push(1.0); // if the attribute is not set, we want to ignore that channel, so we set the weight to 1\n      } else {\n        const value = parseFloat(this.getAttribute(attr));\n        if (isNaN(value)) {\n          throw new Error(`${attr} must be a number`);\n        }\n        weights.push(Math.max(0, value)); // set to 0 if negative\n      }\n    }\n\n    this.effects[0].updateWeights(...weights);\n  }\n}\n\ncustomElements.define('hello-world-effect', HelloWorldEffectElement);\n\nexport default HelloWorldEffectElement;"],"names":["HelloWorldEffect","Effect","blendFunction","BlendFunction","weights","Vector3","Uniform","r","g","b","HelloWorldEffectElement","_a","effect","name","oldValue","newValue","attrs","attr","value"],"mappings":"iUAIA,MAAMA,UAAyBC,EAAAA,MAAO,CACpC,YAAY,CACV,cAAAC,EAAgBC,EAAa,cAAC,OAC9B,QAAAC,EAAU,IAAIC,EAAO,QAAC,EAAK,EAAK,CAAG,CACvC,EAAI,GAAI,CAUJ,MAAM,mBARiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQmB,CACxC,cAAAH,EACA,SAAU,IAAI,IAAI,CAChB,CAAC,UAAW,IAAII,UAAQF,CAAO,CAAC,CACxC,CAAO,CACP,CAAK,CACL,CAEE,cAAcG,EAAGC,EAAGC,EAAG,CAErB,KAAK,SAAS,IAAI,SAAS,EAAE,MAAM,IAAIF,EAAGC,EAAGC,CAAC,CAClD,CAEA,CAEA,MAAMC,UAAgC,WAAY,CAChD,WAAW,oBAAqB,CAC9B,MAAO,CAAC,MAAO,QAAS,MAAM,CAClC,CAEE,aAAc,CACZ,MAAO,EAGP,KAAK,QAAU,CAAE,IAAIV,CAAoB,CAC7C,CAEE,mBAAoB,OAOlB,GANA,MAAM,mBAAqB,MAAM,kBAAmB,IAEhDW,EAAA,KAAK,aAAL,YAAAA,EAAiB,SAAS,iBAAkB,oBAC9C,KAAK,eAAiB,KAAK,YAGzB,CAAC,KAAK,eACR,MAAM,IAAI,MACR,+DACD,EAGH,KAAK,cAAe,EAGpB,KAAK,eAAe,cAAe,CACvC,CAEE,sBAAuB,OAErB,MAAM,sBAAwB,MAAM,qBAAsB,EAC1D,UAAWC,KAAU,KAAK,QACxBA,EAAO,QAAS,GAElBD,EAAA,KAAK,iBAAL,MAAAA,EAAqB,eACzB,CAEE,yBAAyBE,EAAMC,EAAUC,EAAU,OACjD,KAAK,cAAe,GAEpBJ,EAAA,KAAK,iBAAL,MAAAA,EAAqB,aACzB,CAEE,eAAgB,CAId,IAAIP,EAAU,CAAE,EAChB,MAAMY,EAAQ,CAAC,MAAO,QAAS,MAAM,EAErC,UAAWC,KAAQD,EACjB,GAAI,CAAC,KAAK,aAAaC,CAAI,EACzBb,EAAQ,KAAK,CAAG,MACX,CACL,MAAMc,EAAQ,WAAW,KAAK,aAAaD,CAAI,CAAC,EAChD,GAAI,MAAMC,CAAK,EACb,MAAM,IAAI,MAAM,GAAGD,CAAI,mBAAmB,EAE5Cb,EAAQ,KAAK,KAAK,IAAI,EAAGc,CAAK,CAAC,CACvC,CAGI,KAAK,QAAQ,CAAC,EAAE,cAAc,GAAGd,CAAO,CAC5C,CACA,CAEA,sBAAe,OAAO,qBAAsBM,CAAuB"}